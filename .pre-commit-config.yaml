# Pre-commit hooks for State Separator
# Install: pip install pre-commit && pre-commit install
# Run all: pre-commit run --all-files
# Update hooks: pre-commit autoupdate

# Global exclusions (applied to all hooks)
exclude: ^external/

repos:
# =============================================================================
# General hooks
# =============================================================================
- repo: https://github.com/pre-commit/pre-commit-hooks
  rev: v6.0.0
  hooks:
    # Git style
    - id: check-added-large-files
    - id: check-merge-conflict
    - id: check-vcs-permalinks
    - id: forbid-new-submodules

    # Common errors
    - id: end-of-file-fixer
    - id: trailing-whitespace
      args: [--markdown-linebreak-ext=md]
      exclude: CHANGELOG.md
    - id: check-json
    - id: check-yaml
    - id: check-merge-conflict
    - id: check-executables-have-shebangs

    # Cross platform
    - id: check-case-conflict
    - id: mixed-line-ending
      args: [--fix=lf]

    # Security
    - id: detect-aws-credentials
      args: ['--allow-missing-credentials']
    - id: detect-private-key

# =============================================================================
# Shell formatting
# =============================================================================
- repo: https://github.com/jumanjihouse/pre-commit-hooks
  rev: 3.0.0
  hooks:
   - id: shfmt
     args: ['-l', '-i', '2', '-ci', '-sr', '-w']
   - id: shellcheck

# =============================================================================
# C++ Linters & Formatters
# =============================================================================
- repo: https://github.com/pre-commit/mirrors-clang-format
  rev: v21.1.8
  hooks:
    - id: clang-format
      types_or: [c++, c]
      files: ^src/
      args: ['--style=file', '--fallback-style=Google']

- repo: https://github.com/pocc/pre-commit-hooks
  rev: v1.3.5
  hooks:
    - id: cppcheck
      args:
        - '--language=c++'                   # Force C++ mode for .h files
        - '--enable=warning,performance,portability'
        - '--suppress=missingIncludeSystem'
        - '--suppress=missingInclude'        # Skip Eigen headers
        - '--suppress=unusedFunction'
        - '--suppress=unmatchedSuppression'
        - '--suppress=uninitMemberVar'       # Legacy code - copy constructors
        - '--suppress=uninitMemberVarPrivate'
        - '--suppress=operatorEqVarError'    # Legacy code - operator=
        - '--suppress=useInitializationList' # Performance style suggestion
        - '--suppress=literalWithCharPtrCompare'  # main.cpp string compare
      files: ^src/.*\.(cpp|h)$

# =============================================================================
# HTML/CSS Formatting (Prettier)
# =============================================================================
- repo: https://github.com/pre-commit/mirrors-prettier
  rev: v4.0.0-alpha.8
  hooks:
    - id: prettier
      types_or: [html, css]
      files: ^public_html/
      args: ['--write']

# =============================================================================
# PHP Linters
# =============================================================================
- repo: local
  hooks:
    - id: php-lint
      name: php-lint
      entry: php
      language: system
      types: [php]
      args: ['-l']
      files: ^public_html/.*\.php$

    # PHP Code Beautifier - auto-fixes style issues (requires: composer global require squizlabs/php_codesniffer)
    - id: phpcbf
      name: phpcbf (auto-fix)
      entry: phpcbf
      language: system
      types: [php]
      files: ^public_html/.*\.php$
      args: ['--standard=PSR12', '--exclude=Generic.Files.LineLength']


# =============================================================================
# Dockerfile linting
# =============================================================================
- repo: https://github.com/hadolint/hadolint
  rev: v2.14.0
  hooks:
    - id: hadolint
      args:
        - '--ignore=DL3008'  # Don't pin apt versions (impractical for Debian)
        - '--ignore=DL3009'  # Don't require apt-get clean (done in same RUN)
        - '--ignore=DL3059'  # Allow multiple RUN instructions (readability)
